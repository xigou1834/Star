const fs = require('fs');
const path = require('path');
const { JSDOM } = require('jsdom');

const output = [];
const exclude = ['header.html', 'footer.html', 'search-results.html'];

fs.readdirSync(__dirname).forEach(file => {
  const isHTML = file.endsWith('.html');
  const isComponent = file.startsWith('_'); // 可选，用于排除 _header.html 这种
  const isExcluded = exclude.includes(file);

  if (isHTML && !isComponent && !isExcluded) {
    const html = fs.readFileSync(path.join(__dirname, file), 'utf-8');
    const dom = new JSDOM(html);
    const doc = dom.window.document;

    const title = doc.querySelector('title')?.textContent || '';
    const bodyText = doc.body.textContent.replace(/\s+/g, ' ').trim();

    output.push({
      title,
      content: bodyText,
      url: file
    });
  }
});

fs.writeFileSync('data.json', JSON.stringify(output, null, 2), 'utf-8');
console.log(`✅ 已生成 data.json，共 ${output.length} 条记录`);
