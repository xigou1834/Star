<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>搜索结果 - STAR</title>
<link rel="stylesheet" href="style.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
  /* 你的高亮样式 */
  .highlight {
    background-color: #fff8c5;
    padding: 0 2px;
    border-radius: 3px;
    font-weight: 500;
  }
  /* 搜索结果页样式 */
  .search-results {
    max-width: 700px;
    margin: 40px auto;
    padding: 0 20px;
  }
  .search-header h1 {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 10px;
    color: #1d1d1f;
  }
  .search-header p {
    color: #86868b;
    font-size: 14px;
  }
  .result-card {
    margin-bottom: 30px;
    padding-bottom: 30px;
    border-bottom: 1px solid #d2d2d7;
  }
  .result-card h2 {
    font-size: 20px;
    font-weight: 500;
    margin-bottom: 5px;
    line-height: 1.3;
  }
  .result-card h2 a {
    color: #1a73e8;
    text-decoration: none;
  }
  .result-card h2 a:hover {
    text-decoration: underline;
  }
  .result-card .url {
    color: #0d652d;
    font-size: 14px;
    margin-bottom: 5px;
    word-break: break-all;
  }
  .result-card .snippet {
    color: #515154;
    font-size: 16px;
    line-height: 1.5;
  }
</style>
</head>
<body>
<header>
  <!-- 这里可以放你的导航模板，或者直接include后续改 -->
  <nav>
    <div class="nav-container">
      <div class="logo"><a href="index.html" style="color:#1d1d1f; text-decoration:none;">STAR</a></div>
      <ul class="nav-links">
        <li class="dropdown">
          <a href="#">产品</a>
          <div class="dropdown-content">
            <a href="#">软件</a>
            <a href="#">网页</a>
            <a href="#">产品</a>
          </div>
        </li>
        <!-- 其他菜单项省略，跟你之前一致 -->
      </ul>
    </div>
  </nav>
</header>

<main>
  <section class="search-results">
    <div class="search-header">
      <h1>搜索结果："<span id="searchQuery"></span>"</h1>
      <p>找到 <span id="resultCount">0</span> 条结果</p>
    </div>

    <div id="resultsContainer"></div>
  </section>
</main>

<footer>
  <p>版权所有 © 2023-2025. Star(dengruixun) 保留所有权利。</p>
</footer>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('q')?.trim() || '';

    const searchQueryEl = document.getElementById('searchQuery');
    const resultCountEl = document.getElementById('resultCount');
    const resultsContainer = document.getElementById('resultsContainer');

    searchQueryEl.textContent = query;

    // 简单高亮函数
    function highlight(text, term) {
      if (!term) return text;
      const escapedTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      const regex = new RegExp(`(${escapedTerm})`, 'gi');
      return text.replace(regex, '<span class="highlight">$1</span>');
    }

    // 显示无结果提示
    function showNoResults() {
      resultsContainer.innerHTML = `
        <p>没有找到与"<strong>${query}</strong>"相关的结果。</p>
        <p>建议：</p>
        <ul>
          <li>检查输入是否正确</li>
          <li>尝试不同的关键词</li>
          <li>使用更通用的搜索词</li>
        </ul>
      `;
      resultCountEl.textContent = '0';
    }

    if (!query) {
      showNoResults();
      return;
    }

    // 读取 data.json 进行搜索
    fetch('data.json')
      .then(res => res.json())
      .then(data => {
        // 过滤匹配项（标题或内容包含搜索词）
        const lowerQuery = query.toLowerCase();
        const filtered = data.filter(item => 
          item.title.toLowerCase().includes(lowerQuery) ||
          item.content.toLowerCase().includes(lowerQuery)
        );

        if (filtered.length === 0) {
          showNoResults();
          return;
        }

        resultCountEl.textContent = filtered.length.toString();

        // 渲染结果列表
        resultsContainer.innerHTML = filtered.map(item => {
          // 截取内容片段，显示关键字上下文，最多100字
          let snippet = item.content;
          let idx = snippet.toLowerCase().indexOf(lowerQuery);
          if (idx >= 0) {
            const start = Math.max(0, idx - 20);
            const end = Math.min(snippet.length, idx + 80);
            snippet = snippet.substring(start, end) + (end < snippet.length ? '...' : '');
          } else {
            snippet = snippet.substring(0, 100) + (snippet.length > 100 ? '...' : '');
          }

          return `
            <div class="result-card">
              <h2><a href="${item.url}">${highlight(item.title, query)}</a></h2>
              <p class="url">${item.url}</p>
              <p class="snippet">${highlight(snippet, query)}</p>
            </div>
          `;
        }).join('');
      })
      .catch(err => {
        resultsContainer.innerHTML = `<p>加载搜索数据失败，请稍后重试。</p>`;
        resultCountEl.textContent = '0';
        console.error(err);
      });
  });
</script>

</body>
</html>
