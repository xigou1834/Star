<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>搜索结果 - STAR</title>
  <link rel="stylesheet" href="style.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <style>
    /* 高亮样式 */
    .highlight {
      background-color: #fff8c5;
      padding: 0 2px;
      border-radius: 3px;
      font-weight: 500;
    }

    /* 搜索结果页特定样式 */
    .search-results {
      max-width: 700px;
      margin: 40px auto;
      padding: 0 20px;
    }

    .search-header {
      margin-bottom: 30px;
    }

    .search-header h1 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 10px;
      color: #1d1d1f;
    }

    .search-header p {
      color: #86868b;
      font-size: 14px;
    }

    .result-card {
      margin-bottom: 30px;
      padding-bottom: 30px;
      border-bottom: 1px solid #d2d2d7;
    }

    .result-card h2 {
      font-size: 20px;
      font-weight: 500;
      margin-bottom: 5px;
      line-height: 1.3;
    }

    .result-card h2 a {
      color: #1a73e8;
      text-decoration: none;
    }

    .result-card h2 a:hover {
      text-decoration: underline;
    }

    .result-card .url {
      color: #0d652d;
      font-size: 14px;
      margin-bottom: 5px;
      word-break: break-all;
    }

    .result-card .snippet {
      color: #515154;
      font-size: 16px;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <div class="nav-container">
        <div class="logo">STAR</div>
        <ul class="nav-links">
          <li class="dropdown">
            <a href="#">产品</a>
            <div class="dropdown-content">
              <a href="#">软件</a>
              <a href="#">网页</a>
              <a href="#">产品</a>
            </div>
          </li>
          <li class="dropdown">
            <a href="#">资源</a>
            <div class="dropdown-content">
              <a href="#">资源中心</a>
            </div>
          </li>
          <li class="dropdown">
            <a href="#">博客</a>
            <div class="dropdown-content">
              <a href="#">STAR论坛</a>
            </div>
          </li>
          <li class="dropdown">
            <a href="#">开发者</a>
            <div class="dropdown-content">
              <a href="#">帮助我们</a>
              <a href="#">开发与创新</a>
              <a href="#">加入我们</a>
            </div>
          </li>
          <li class="dropdown">
            <a href="#">技术与支持</a>
            <div class="dropdown-content">
              <a href="#">联系我们</a>
            </div>
          </li>
          <li class="dropdown search-dropdown active">
            <a href="#"><i class="fas fa-search"></i></a>
            <div class="dropdown-content search-panel">
              <form id="searchForm" action="search-results.html" method="GET">
                <input
                  type="text"
                  name="q"
                  placeholder="搜索..."
                  id="searchInput"
                  autocomplete="off"
                  value=""
                />
                <button type="submit"><i class="fas fa-search"></i></button>
              </form>
            </div>
          </li>
        </ul>
      </div>
    </nav>
  </header>

  <main>
    <section class="search-results">
      <div class="search-header">
        <h1>“<span id="searchQuery"></span>” 的搜索结果</h1>
        <p>找到 <span id="resultCount">0</span> 条结果</p>
      </div>

      <div class="results-container" id="resultsContainer">
        <!-- 结果通过JS动态生成 -->
      </div>
    </section>
  </main>

  <footer>
    <p>版权所有 © 2023-2025. Star(dengruixun) 保留所有权利。</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', async function () {
      const searchInput = document.getElementById('searchInput');
      const resultsContainer = document.getElementById('resultsContainer');
      const resultCount = document.getElementById('resultCount');
      const searchQueryElem = document.getElementById('searchQuery');

      // 从URL获取查询词
      const urlParams = new URLSearchParams(window.location.search);
      const query = urlParams.get('q')?.trim().toLowerCase() || '';

      searchInput.value = query;
      searchQueryElem.textContent = query;

      // 高亮匹配关键词
      function highlightText(text, term) {
        if (!term) return text;
        const regex = new RegExp(`(${term.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&')})`, 'gi');
        return text.replace(regex, '<span class="highlight">$1</span>');
      }

      // 读取本地 data.json
      let data = [];
      try {
        const response = await fetch('data.json');
        if (!response.ok) throw new Error('加载数据失败');
        data = await response.json();
      } catch (e) {
        resultsContainer.innerHTML =
          '<p>加载搜索数据失败，请稍后重试。</p>';
        return;
      }

      if (!query) {
        resultsContainer.innerHTML = '<p>请输入关键词进行搜索。</p>';
        resultCount.textContent = '0';
        return;
      }

      // 简单搜索：标题或内容包含关键词
      const results = data.filter(
        (item) =>
          item.title.toLowerCase().includes(query) ||
          item.content.toLowerCase().includes(query)
      );

      resultCount.textContent = results.length;

      if (results.length === 0) {
        resultsContainer.innerHTML = `
          <div class="no-results">
            <p>没有找到与“${query}”相关的结果</p>
            <p>建议：</p>
            <ul>
              <li>检查输入是否正确</li>
              <li>尝试不同的关键词</li>
              <li>使用更通用的搜索词</li>
            </ul>
          </div>
        `;
        return;
      }

      // 渲染搜索结果
      resultsContainer.innerHTML = results
        .map(
          (item) => `
        <div class="result-card">
          <h2><a href="${item.url}">${highlightText(item.title, query)}</a></h2>
          <p class="snippet">${highlightText(
            item.content.substring(0, 200),
            query
          )}...</p>
          <p class="url">${item.url}</p>
        </div>
      `
        )
        .join('');
    });
  </script>
</body>
</html>
